<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="keywords" content="HTML, CSS, JavaScript">
<meta name="author" content="LyPaw(Manuel Fuentes Cruz)">
<title>ViMap</title>
<link rel="icon" type="image/png" href="Logo/icon.png">
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
<script>
  mermaid.initialize({
    startOnLoad: false,
    theme: "dark"
  });
</script>
<style>
    body {
        margin: 0;
        font-family: Consolas, monospace;
        background: #0f172a;
        color: #d4d4d4;
        display: flex;
        height: 100vh;
    }

    .sidebar {
        width: 300px;
        background: #020617;
        border-right: 1px solid #1e293b;
        padding: 10px;
        overflow-y: auto;
    }

    .folder, .subfolder {
        font-weight: bold;
        color: #cbd5e1;
        margin-top: 10px;
        cursor: pointer;
        user-select: none;
    }

    .subfolder { padding-left: 20px; font-size: 0.95em; }

    .file {
        padding-left: 40px;
        cursor: pointer;
        color: #94a3b8;
        margin: 5px 0;
    }

    .file:hover { color: white; }

    .file.active {
        color: #fff;
        background: #4f46e5;
        border-radius: 6px;
        padding: 2px 6px;
    }

    .children {
        display: none;
    }

    .folder.open > .children,
    .subfolder.open > .children {
        display: block;
    }

    .viewer {
        flex: 1;
        padding: 20px;
        overflow: auto;
    }

    pre {
        background: #1e1e1e;
        padding: 20px;
        border-radius: 10px;
        overflow-x: auto;
        line-height: 1.6;
    }

    iframe {
        width: 100%;
        height: 80vh;
        border: none;
        border-radius: 10px;
    }

    .keyword { color: #569cd6; font-weight: bold; }
    .class { color: #4ec9b0; font-weight: bold; }
    .string { color: #ce9178; }
    .comment { color: #6a9955; font-style: italic; }
    .number { color: #b5cea8; }
    
    .pdf-viewer {
        width: 100%;
        height: 85vh;
        border: none;
        border-radius: 10px;
    }

    .markdown table {
        width: 100%;
        border-collapse: collapse;
        margin: 20px 0;
        background: #1e1e1e;
        color: #e5e7eb;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
    }

    .markdown table thead {
        background: #2d2d2d;
    }

    .markdown table th {
        background: #252526;
        color: #ffffff;
        font-weight: bold;
        padding: 12px 15px;
        text-align: left;
        border-bottom: 2px solid #4f46e5;
    }

    .markdown table td {
        padding: 10px 15px;
        border-bottom: 1px solid #3a3a3a;
        color: #e5e7eb;
    }

    .markdown table tr {
        border-bottom: 1px solid #3a3a3a;
    }

    .markdown table tr:last-child td {
        border-bottom: none;
    }

    .markdown table tr:hover td {
        background: #2a2a2a;
    }

    .markdown table tbody tr:nth-child(even) td {
        background: #252525;
    }

    .markdown table tbody tr:nth-child(odd) td {
        background: #1e1e1e;
    }

    .markdown h1 { color: #e5e7eb; margin: 0; }
    .markdown h2 { color: #c7d2fe; margin: 0; }
    .markdown h3 { color: #a5b4fc; margin: 0; }
    .markdown p { margin: 0; line-height: 1.45; }
    .markdown ul, .markdown ol { margin: 0; }
    .markdown li { margin: 0; }
    .markdown code { 
        background: #111827;
        border-radius: 4px;
        color: #fca5a5;
    }
    .markdown pre { 
        background: #111827;
        padding: 12px 14px;
        border-radius: 10px;
        overflow-x: auto;
        line-height: 1.45;
        box-shadow: inset 0 0 0 1px #1e293b;
    }
    .markdown pre code {
        background: none;
        padding: 0;
        color: #e5e7eb;
        font-family: Consolas, monospace;
    }
    .markdown pre::-webkit-scrollbar { height: 8px; }
    .markdown pre::-webkit-scrollbar-thumb {
        background: #334155;
        border-radius: 4px;
    }
    .markdown .language-mermaid {
        display: flex;
        justify-content: center;
        margin: 20px 0;
    }
    .markdown .language-mermaid svg {
        background: #1e1e1e;
        border-radius: 10px;
        padding: 10px;
    }
    .markdown .language-mermaid .label,
    .markdown .language-mermaid .edgeLabel,
    .markdown .language-mermaid .nodeLabel {
        fill: #0f172a;
    }
    .markdown .language-mermaid .edgePath path,
    .markdown .language-mermaid .cluster rect {
        stroke: #c7d2fe;
    }
    .markdown .language-mermaid .node rect {
        stroke: #94a3b8;
        fill: #cbd5e1;
    }
</style>
</head>

<body>

<div class="sidebar">
    <div class="logo">
        <img src="Logo/logo.png" alt="Logo" style="max-width: 100%; height: auto;" />
    </div>
    <div id="sidebar"></div>
</div>

<div class="viewer">
    <h2 id="title">Selecciona un archivo</h2>
    <pre id="code">üìÇ Elige un archivo de la izquierda‚Ä¶</pre>
</div>

<script>
const fileTree = {
  Java: {
    "Array": {
      "Teor√≠a": [
        { 
          name: "Array_Teor√≠a.md",
          url: "https://raw.githubusercontent.com/LyPaw/ViMap/09455fa92f2e6cfa5f4e39002f9d5a7d4116e492/DAM/Java/Array/Readme.md"
        }
      ],
      "Ejercicios": [
        { 
          name: "Ejercicios_Array.md",
          url: "https://raw.githubusercontent.com/LyPaw/ViMap/09455fa92f2e6cfa5f4e39002f9d5a7d4116e492/DAM/Java/Array/Ejercicios/Readme.md"
        }
      ]
    },
    "Colecciones": {
      "Conceptos_Clave": [
        { 
          name: "Array_List.java",
          url: "https://raw.githubusercontent.com/LyPaw/ViMap/09455fa92f2e6cfa5f4e39002f9d5a7d4116e492/DAM/Java/ArrayList/Clave/Array_List.java"
        },
        { 
          name: "Conjuntos.java",
          url: "https://raw.githubusercontent.com/LyPaw/ViMap/09455fa92f2e6cfa5f4e39002f9d5a7d4116e492/DAM/Java/Conjuntos/Clave/Conjuntos.java"
        },
        { 
          name: "Mapas.java",
          url: "https://raw.githubusercontent.com/LyPaw/ViMap/4d9ef105ec862a1093d807e6dba084fde57ca259/DAM/Java/Mapas/Clave/Mapas.java"
        }
      ]
    }
  },
  BaseDeDatos: {
    "ER": {
      "Teor√≠a": [
        { 
          name: "ER_Teor√≠a.md",
          url: "https://raw.githubusercontent.com/LyPaw/ViMap/b41c3652d7a0338f98b19921ff61899b012b65cf/DAM/Base_De_Datos/Teor%C3%ADa/Readme.md"
        }
      ],
      "Ejercicios": [
        { 
          name: "Ejercicios_ER.md",
          url: "https://raw.githubusercontent.com/LyPaw/ViMap/b41c3652d7a0338f98b19921ff61899b012b65cf/DAM/Base_De_Datos/Ejercicios/Readme.md"
        }
      ]
    },
    "SQL": {
      "Conceptos_Clave": []
    }
  }
};

const sidebar = document.getElementById("sidebar");
const codeEl = document.getElementById("code");
const titleEl = document.getElementById("title");


const openFolders = new Set();

for (const lang in fileTree) {
    const folder = document.createElement("div");
    folder.className = "folder";
    folder.textContent = "üìÅ " + lang;
    folder.dataset.folder = lang;

    const childrenContainer = document.createElement("div");
    childrenContainer.className = "children";

    const topics = fileTree[lang];
    for (const topic in topics) {
        const subfolder = document.createElement("div");
        subfolder.className = "subfolder";
        subfolder.textContent = "üìÇ " + topic;

        const subChildren = document.createElement("div");
        subChildren.className = "children";

        const subTopics = topics[topic];

        for (const subtopic in subTopics) {
            const subSubFolder = document.createElement("div");
            subSubFolder.className = "subfolder";
            subSubFolder.style.paddingLeft = "40px";
            subSubFolder.textContent = "üìÇ " + subtopic;

            const filesContainer = document.createElement("div");
            filesContainer.className = "children";

            subTopics[subtopic].forEach(file => {
                const fileEl = document.createElement("div");
                fileEl.className = "file";
                fileEl.textContent = "üìÑ " + file.name;
                fileEl.onclick = (e) => {
                    e.stopPropagation();
                    loadFile(file, fileEl, folder, subSubFolder);
                };
                filesContainer.appendChild(fileEl);
            });

            subSubFolder.appendChild(filesContainer);

            subSubFolder.addEventListener("click", e => {
                e.stopPropagation();
                subSubFolder.classList.toggle("open");
            });

            subChildren.appendChild(subSubFolder);
        }

        subfolder.appendChild(subChildren);

        subfolder.addEventListener("click", e => {
            e.stopPropagation();
            subfolder.classList.toggle("open");
        });

        childrenContainer.appendChild(subfolder);
    }

    folder.appendChild(childrenContainer);

    folder.addEventListener("click", (e) => {
        e.stopPropagation();
        folder.classList.toggle("open");
        
        const subfolders = folder.querySelectorAll(".subfolder");
        if (folder.classList.contains("open")) {
            subfolders.forEach(sf => sf.classList.add("open"));
        }
    });

    sidebar.appendChild(folder);
}

function loadFile(file, el, parentFolder, parentSubfolder) {

    if (parentFolder && !parentFolder.classList.contains("open")) {
        parentFolder.classList.add("open");
    }
    if (parentSubfolder && !parentSubfolder.classList.contains("open")) {
        parentSubfolder.classList.add("open");
    }

    document.querySelectorAll(".file").forEach(f => f.classList.remove("active"));
    el.classList.add("active");

    titleEl.textContent = file.name;
    codeEl.innerHTML = "‚è≥ Cargando‚Ä¶";

    const cleanUrl = file.url.trim();

    if (file.name.endsWith(".md")) {
        fetch(cleanUrl)
            .then(r => {
                if (!r.ok) throw new Error('Archivo no encontrado');
                return r.text();
            })
            .then(md => {
                codeEl.innerHTML = `<div class="markdown">${marked.parse(md)}</div>`;
                
                setTimeout(() => {
                    mermaid.run({
                        querySelector: ".markdown .language-mermaid"
                    });
                }, 100);
            })
            .catch(err => {
                codeEl.innerHTML = `‚ùå Error: ${err.message}`;
            });
    }
    else if (file.name.endsWith(".pdf")) {
        const pdfViewerUrl = `https://docs.google.com/gview?url=${encodeURIComponent(cleanUrl)}&embedded=true`;
        codeEl.innerHTML = `<iframe class="pdf-viewer" src="${pdfViewerUrl}"></iframe>`;
    } 
    else {
        fetch(cleanUrl)
            .then(r => {
                if (!r.ok) throw new Error('Archivo no encontrado');
                return r.text();
            })
            .then(text => {
                codeEl.innerHTML = highlightJava(text);
                codeEl.scrollTop = 0;
            })
            .catch(err => {
                codeEl.innerHTML = `‚ùå Error: ${err.message}`;
            });
    }
}

function escapeHTML(str) {
    return str
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;");
}

function highlightJava(code) {

    code = escapeHTML(code);

    const protectedParts = [];
    

    code = code.replace(/("(?:[^"\\]|\\.)*"|'(?:[^'\\]|\\.)*')/g, match => {
        protectedParts.push({type: 'string', content: match});
        return `__STRING_${protectedParts.length - 1}__`;
    });

    code = code.replace(/\/\/.*/g, match => {
        protectedParts.push({type: 'comment', content: match});
        return `__COMMENT_${protectedParts.length - 1}__`;
    });
    
    code = code.replace(/\/\*[\s\S]*?\*\//g, match => {
        protectedParts.push({type: 'comment', content: match});
        return `__COMMENT_${protectedParts.length - 1}__`;
    });
    
    const keywords = /\b(class|public|private|protected|static|void|new|return|if|else|for|while|do|switch|case|break|continue|int|double|float|boolean|char|String|Set|HashSet|Map|HashMap|List|ArrayList|import|package|extends|implements|interface|abstract|final|try|catch|finally|throw|throws|this|super|instanceof|true|false|null|var|System|out|println|print|length|size|add|remove|get|put|contains|equals|toString)\b/g;
    code = code.replace(keywords, '<span class="keyword">$&</span>');
    
    code = code.replace(/\b(\d+\.?\d*([eE][+-]?\d+)?)\b/g, '<span class="number">$1</span>');

    const classRegex = /\b([A-Z][a-zA-Z0-9_]*)\b/g;
    code = code.replace(classRegex, match => {
        const lower = match.toLowerCase();
        const keywordList = ['class', 'public', 'private', 'protected', 'static', 'void', 'new', 'return', 'if', 'else', 'for', 'while', 'int', 'double', 'float', 'boolean', 'char', 'string', 'set', 'hashset', 'map', 'hashmap', 'list', 'arraylist', 'import', 'package', 'extends', 'implements', 'interface', 'abstract', 'final', 'try', 'catch', 'finally', 'throw', 'throws', 'this', 'super', 'instanceof', 'true', 'false', 'null', 'var', 'system', 'out'];
        if (keywordList.includes(lower)) {
            return match;
        }
        return `<span class="class">${match}</span>`;
    });
    
    code = code.replace(/__STRING_(\d+)__/g, (_, index) => {
        return `<span class="string">${protectedParts[index].content}</span>`;
    });
    
    code = code.replace(/__COMMENT_(\d+)__/g, (_, index) => {
        return `<span class="comment">${protectedParts[index].content}</span>`;
    });
    
    return code;
}
</script>

</body>
</html>

