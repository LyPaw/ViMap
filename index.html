<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>ViMap</title>
<link rel="icon" type="image/svg+xml" href="Logo/logo.svg">
<style>
    body {
        margin: 0;
        font-family: Consolas, monospace;
        background: #0f172a;
        color: #d4d4d4;
        display: flex;
        height: 100vh;
    }

    .sidebar {
        width: 300px;
        background: #020617;
        border-right: 1px solid #1e293b;
        padding: 10px;
        overflow-y: auto;
    }

    .folder, .subfolder {
        font-weight: bold;
        color: #cbd5e1;
        margin-top: 10px;
        cursor: pointer;
        user-select: none;
    }

    .subfolder { padding-left: 20px; font-size: 0.95em; }

    .file {
        padding-left: 40px;
        cursor: pointer;
        color: #94a3b8;
        margin: 5px 0;
    }

    .file:hover { color: white; }

    .file.active {
        color: #fff;
        background: #4f46e5;
        border-radius: 6px;
        padding: 2px 6px;
    }

    .children {
        display: none;
    }

    .folder.open > .children,
    .subfolder.open > .children {
        display: block;
    }


    .viewer {
        flex: 1;
        padding: 20px;
        overflow: auto;
    }

    pre {
        background: #1e1e1e;
        padding: 20px;
        border-radius: 10px;
        overflow-x: auto;
        line-height: 1.6;
    }

    iframe {
        width: 100%;
        height: 80vh;
        border: none;
        border-radius: 10px;
    }


    .keyword { color: #569cd6; font-weight: bold; }
    .class { color: #4ec9b0; font-weight: bold; }
    .string { color: #ce9178; }
    .comment { color: #6a9955; font-style: italic; }
    .number { color: #b5cea8; }
    
    /* Estilo para el visor de PDF */
    .pdf-viewer {
        width: 100%;
        height: 85vh;
        border: none;
        border-radius: 10px;
    }
</style>
</head>

<body>

<div class="sidebar">
    <div class="logo">
        <img src="Logo/logo.svg" alt="Logo" style="max-width: 100%; height: auto;" />
    </div>
    <div id="sidebar"></div>
</div>

<div class="viewer">
    <h2 id="title">Selecciona un archivo</h2>
    <pre id="code">üìÇ Elige un archivo de la izquierda‚Ä¶</pre>
</div>

<script>
const fileTree = {
    Java: {
       "Colecciones": [
    { 
        "name": "Array_List.java",
        "url": "https://raw.githubusercontent.com/LyPaw/ViMap/4292da45da77e88398d117b33fa7c736c195cba8/DAM/Java/Array_List.java"
    },
    { 
        "name": "Conjuntos.java",
        "url": "https://raw.githubusercontent.com/LyPaw/ViMap/4292da45da77e88398d117b33fa7c736c195cba8/DAM/Java/Conjuntos.java"
    },
    { 
        "name": "Mapas.java",
        "url": "https://raw.githubusercontent.com/LyPaw/ViMap/4292da45da77e88398d117b33fa7c736c195cba8/DAM/Java/Mapas.java"
    },
    { 
        "name": "Arrays.pdf",
        "url": "https://raw.githubusercontent.com/LyPaw/ViMap/5e959e7c71fad2fe9fe95ba49aa2879ec2deef53/DAM/Java/Arrays.pdf"
    },
],
        "Variables": [  
        ],
    }
};

const sidebar = document.getElementById("sidebar");
const codeEl = document.getElementById("code");
const titleEl = document.getElementById("title");

// Mantener track de las carpetas abiertas
const openFolders = new Set();

for (const lang in fileTree) {
    const folder = document.createElement("div");
    folder.className = "folder";
    folder.textContent = "üìÅ " + lang;
    folder.dataset.folder = lang;

    const childrenContainer = document.createElement("div");
    childrenContainer.className = "children";

    const topics = fileTree[lang];
    for (const topic in topics) {
        const subfolder = document.createElement("div");
        subfolder.className = "subfolder";
        subfolder.textContent = "üìÇ " + topic;
        subfolder.dataset.subfolder = topic;

        const subChildren = document.createElement("div");
        subChildren.className = "children";

        topics[topic].forEach(file => {
            const fileEl = document.createElement("div");
            fileEl.className = "file";
            fileEl.textContent = "üìÑ " + file.name;
            fileEl.dataset.file = file.name;
            fileEl.onclick = (e) => {
                e.stopPropagation();
                loadFile(file, fileEl, folder, subfolder);
            };
            subChildren.appendChild(fileEl);
        });

        subfolder.appendChild(subChildren);

        subfolder.addEventListener("click", e => {
            e.stopPropagation();
            subfolder.classList.toggle("open");
            if (subfolder.classList.contains("open")) {
                openFolders.add(`${lang}-${topic}`);
            } else {
                openFolders.delete(`${lang}-${topic}`);
            }
        });

        // Restaurar estado si estaba abierto
        if (openFolders.has(`${lang}-${topic}`)) {
            subfolder.classList.add("open");
        }

        childrenContainer.appendChild(subfolder);
    }

    folder.appendChild(childrenContainer);

    folder.addEventListener("click", (e) => {
        e.stopPropagation();
        folder.classList.toggle("open");
        
        // Abrir/cerrar todos los subfolders
        const subfolders = folder.querySelectorAll(".subfolder");
        if (folder.classList.contains("open")) {
            subfolders.forEach(sf => sf.classList.add("open"));
        }
    });

    sidebar.appendChild(folder);
}

function loadFile(file, el, parentFolder, parentSubfolder) {
    // Mantener las carpetas abiertas
    if (parentFolder && !parentFolder.classList.contains("open")) {
        parentFolder.classList.add("open");
    }
    if (parentSubfolder && !parentSubfolder.classList.contains("open")) {
        parentSubfolder.classList.add("open");
    }

    document.querySelectorAll(".file").forEach(f => f.classList.remove("active"));
    el.classList.add("active");

    titleEl.textContent = file.name;
    codeEl.innerHTML = "‚è≥ Cargando‚Ä¶";

    const cleanUrl = file.url.trim();

    if (file.name.endsWith(".pdf")) {
        // Usar Google Docs Viewer para visualizar PDFs
        const pdfViewerUrl = `https://docs.google.com/gview?url=${encodeURIComponent(cleanUrl)}&embedded=true`;
        codeEl.innerHTML = `<iframe class="pdf-viewer" src="${pdfViewerUrl}"></iframe>`;
    } else {
        fetch(cleanUrl)
            .then(r => {
                if (!r.ok) throw new Error('Archivo no encontrado');
                return r.text();
            })
            .then(text => {
                codeEl.innerHTML = highlightJava(text);
                // Scroll autom√°tico al principio
                codeEl.scrollTop = 0;
            })
            .catch(err => {
                console.error("Error:", err);
                codeEl.innerHTML = `<span style="color: #f87171;">‚ùå Error al cargar archivo. Verifica la URL o el archivo puede no existir.</span>`;
            });
    }
}

function highlightJava(code) {
    // Primero escapamos el HTML para seguridad
    code = code
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;");
    
    // Dividir el c√≥digo en l√≠neas para procesar cada una
    const lines = code.split('\n');
    const result = [];
    
    // Palabras clave de Java
    const keywords = /\b(class|public|private|protected|static|void|new|return|if|else|for|while|do|switch|case|break|continue|int|double|float|boolean|char|String|Set|HashSet|Map|HashMap|List|ArrayList|import|package|extends|implements|interface|abstract|final|try|catch|finally|throw|throws|this|super|instanceof|true|false|null)\b/g;
    
    // Clases comunes (que empiezan con may√∫scula)
    const classes = /\b([A-Z][a-zA-Z0-9_]*)\b/g;
    
    // N√∫meros
    const numbers = /\b(\d+\.?\d*)\b/g;
    
    for (let line of lines) {
        // Saltar l√≠neas vac√≠as
        if (line.trim() === '') {
            result.push('');
            continue;
        }
        
        // Procesar la l√≠nea completa para detectar patrones
        let processed = line;
        
        // 1. Detectar y procesar cadenas de texto (strings)
        let stringParts = [];
        let inString = false;
        let currentString = '';
        let quoteChar = '';
        let buffer = '';
        
        for (let i = 0; i < processed.length; i++) {
            const char = processed[i];
            const nextChar = processed[i + 1] || '';
            
            if ((char === '"' || char === "'") && (i === 0 || processed[i - 1] !== '\\')) {
                if (!inString) {
                    // Inicio de string
                    inString = true;
                    quoteChar = char;
                    if (buffer) stringParts.push({type: 'code', content: buffer});
                    buffer = '';
                    currentString = char;
                } else if (char === quoteChar) {
                    // Fin de string
                    currentString += char;
                    stringParts.push({type: 'string', content: currentString});
                    currentString = '';
                    inString = false;
                    quoteChar = '';
                } else {
                    currentString += char;
                }
            } else if (inString) {
                currentString += char;
            } else {
                buffer += char;
            }
        }
        
        if (buffer) stringParts.push({type: 'code', content: buffer});
        
        // 2. Procesar cada parte
        let finalLine = '';
        for (let part of stringParts) {
            if (part.type === 'string') {
                finalLine += `<span class="string">${part.content}</span>`;
            } else {
                // Procesar c√≥digo (no string)
                let codePart = part.content;
                
                // Detectar comentarios de una l√≠nea
                const commentIndex = codePart.indexOf('//');
                if (commentIndex !== -1) {
                    const codeBefore = codePart.substring(0, commentIndex);
                    const comment = codePart.substring(commentIndex);
                    codePart = codeBefore + `<span class="comment">${comment}</span>`;
                }
                
                // Reemplazar keywords
                codePart = codePart.replace(keywords, match => {
                    return `<span class="keyword">${match}</span>`;
                });
                
                // Reemplazar n√∫meros
                codePart = codePart.replace(numbers, match => {
                    return `<span class="number">${match}</span>`;
                });
                
                // Reemplazar clases (solo si no son keywords)
                codePart = codePart.replace(classes, match => {
                    const lower = match.toLowerCase();
                    const keywordList = ['class', 'public', 'private', 'protected', 'static', 'void', 'new', 'return', 'if', 'else', 'for', 'while', 'int', 'double', 'float', 'boolean', 'char', 'string', 'set', 'hashset', 'map', 'hashmap', 'list', 'arraylist', 'import', 'package', 'extends', 'implements', 'interface', 'abstract', 'final', 'try', 'catch', 'finally', 'throw', 'throws', 'this', 'super', 'instanceof', 'true', 'false', 'null'];
                    if (keywordList.includes(lower)) {
                        return match; // Ya fue procesado como keyword
                    }
                    return `<span class="class">${match}</span>`;
                });
                
                finalLine += codePart;
            }
        }
        
        result.push(finalLine);
    }
    
    return result.join('\n');
}
</script>

</body>
</html>
